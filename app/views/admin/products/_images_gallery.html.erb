<% if product.s3_has_images? %>
  <% cache_buster = product.updated_at.to_i %>
  <div class="product-images-gallery">
    <% product.s3_image_count.times do |i| %>
      <div style="display: flex; gap: 20px; margin-bottom: 20px; padding: 15px; background: #f9f9f9; border-radius: 8px; align-items: flex-start;">
        
        <!-- Thumbnail -->
        <div style="text-align: center;">
          <div style="font-size: 11px; color: #666; margin-bottom: 5px;">Thumbnail (300px)</div>
          <%= image_tag "#{product.s3_thumbnail_url(i)}?v=#{cache_buster}", 
              style: "border: 1px solid #ddd; border-radius: 4px; max-width: 150px;",
              alt: "Thumbnail #{i + 1}" %>
        </div>
        
        <!-- Original -->
        <div style="text-align: center; flex: 1;">
          <div style="font-size: 11px; color: #666; margin-bottom: 5px;">Original (1200px)</div>
          <%= image_tag "#{product.s3_original_url(i)}?v=#{cache_buster}", 
              style: "border: 1px solid #ddd; border-radius: 4px; max-width: 400px; max-height: 300px; object-fit: contain;",
              alt: "Original #{i + 1}" %>
        </div>
        
        <!-- Actions -->
        <div style="min-width: 120px; text-align: center;">
          <div style="font-weight: bold; margin-bottom: 10px;">Image <%= i + 1 %></div>
          
          <div style="margin-bottom: 10px;">
            <a href="<%= product.s3_original_url(i) %>" target="_blank" 
               style="display: inline-block; padding: 5px 10px; background: #5E6469; color: white; border-radius: 4px; text-decoration: none; font-size: 12px;">
              View Full Size
            </a>
          </div>
          
          <div style="margin-bottom: 5px;">
            <a href="#" onclick="document.getElementById('replace-form-<%= i %>').style.display='block'; return false;" 
               style="color: #2196F3; font-size: 12px;">Replace</a>
            &nbsp;|&nbsp;
            <%= button_to "Delete", delete_image_admin_product_path(product, index: i), 
                        method: :delete, 
                        data: { confirm: "Delete this image from S3?" },
                        style: "background: none; border: none; color: #f44336; font-size: 12px; cursor: pointer; padding: 0;" %>
          </div>
          
          <!-- Hidden replace form -->
          <div id="replace-form-<%= i %>" style="display: none; margin-top: 10px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 4px;">
            <%= form_tag replace_image_admin_product_path(product), method: :patch, multipart: true do %>
              <%= hidden_field_tag :index, i %>
              <%= file_field_tag :image, accept: "image/*", style: "font-size: 11px; max-width: 100px;" %>
              <br><br>
              <%= submit_tag "Upload", style: "font-size: 11px; padding: 3px 8px;" %>
              <a href="#" onclick="document.getElementById('replace-form-<%= i %>').style.display='none'; return false;"
                 style="margin-left: 5px; font-size: 11px; color: #999;">Cancel</a>
            <% end %>
          </div>
        </div>
      </div>
    <% end %>
  </div>
  
  <div style="margin-top: 15px; padding: 10px; background: #e8f5e9; border-radius: 4px; font-size: 12px;">
    <strong>S3 Location:</strong> 
    <code style="background: #fff; padding: 2px 6px; border-radius: 3px;">
      tstack-desingh/vega-tools/<%= Rails.env %>/images/<%= product.slug %>/
    </code>
  </div>
<% else %>
  <span style="color: #999;">No images uploaded yet</span>
<% end %>
